<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catálogo | Tienda de Juguetes</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__row">
      <a class="brand" href="index.html">Tienda de Juguetes</a>
      <nav class="nav">
        <a href="catalogo.html" class="active">Catálogo</a>
        <a href="carrito.html">Carrito <span id="cartCount" class="badge">0</span></a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="toolbar">
      <div>
        <h1>Catálogo</h1>
        <p class="muted">Agrega productos y finaliza por WhatsApp.</p>
      </div>

      <div class="filters">
        <input id="q" class="input" type="search" placeholder="Buscar..." />
        <select id="cat" class="input">
          <option value="">Todas las categorías</option>
        </select>
      </div>
    </div>

    <div id="grid" class="grid"></div>
  </main>

  <script src="assets/app.js"></script>
  <script>
    (async () => {
      updateCartBadge();
      const products = await loadProducts();
      const grid = document.getElementById('grid');
      const q = document.getElementById('q');
      const cat = document.getElementById('cat');

      const categories = [...new Set(products.map(p => p.category))].sort();
      for (const c of categories) {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        cat.appendChild(opt);
      }

      const apply = () => {
        const term = q.value.trim().toLowerCase();
        const c = cat.value;
        const filtered = products.filter(p => {
          const matchesTerm =
            !term ||
            p.name.toLowerCase().includes(term) ||
            (p.description || "").toLowerCase().includes(term);

          const matchesCat = !c || p.category === c;
          return matchesTerm && matchesCat;
        });

        renderProductCards(filtered, grid);
      };

      q.addEventListener('input', apply);
      cat.addEventListener('change', apply);

      apply();
    })();
  </script>
</body>
</html>
